# 大白鹅哼唱周杰伦歌曲功能使用说明

## 功能介绍

大白鹅现在可以随机哼唱周杰伦的歌曲了！当大白鹅的好感度达到一定水平时，它会随机触发哼唱行为，并通过便签显示正在播放的歌曲名称。

## 使用方法

1. **安装依赖**：
   ```bash
   pip install pygame
   ```

2. **添加音乐文件**：
   - 在程序所在目录中已创建了`周杰伦`文件夹
   - 将周杰伦的音乐文件（支持.mp3、.wav、.ogg、.m4a格式）放入此文件夹
   - 音乐文件命名建议使用歌曲名称，这样在显示时会更加清晰

3. **添加歌词文件（可选）**：
   - 对于需要显示歌词的歌曲，创建同名的.txt文件，放在周杰伦文件夹中
   - 歌词文件每行格式为"时间(秒):歌词内容"或"时间(秒),歌词内容"
   - 可以使用#开头的注释行添加说明信息

4. **启动程序**：
   - 正常启动大白鹅程序
   - 大白鹅的初始好感度已设置为50，达到了哼唱歌曲的条件
   - 大白鹅会随机触发哼唱行为，概率约为34%

## 功能特点

- **随机播放**：每次触发时随机选择一首歌曲播放
- **状态显示**：通过绿色便签显示正在哼唱的歌曲名称
- **音量适中**：默认音量设置为50%，不会太吵
- **自动停止**：程序退出时会自动停止音乐播放
- **增强的稳定性**：添加了完整的错误处理和线程管理
- **详细日志**：播放过程中会在控制台输出详细的调试信息
- **歌词显示功能**：播放音乐时，会在大白鹅下方显示紫色半透明字幕窗口，同步显示歌词内容
- **歌词文件加载**：支持从周杰伦文件夹加载对应歌曲的歌词文件，实现更丰富的字幕显示

## 注意事项

- 如果没有安装pygame库，音乐播放功能将自动禁用，但不会影响程序其他功能
- 如果周杰伦文件夹中没有音乐文件，功能会自动提示，但不会报错
- 好感度会影响触发概率，保持良好的互动可以增加听到歌曲的机会
- 大白鹅的初始好感度已设置为50，足够触发哼唱行为
- **歌词文件格式**：歌词文件需要与对应的音乐文件同名，扩展名改为.txt，放在周杰伦文件夹中
- **歌词文件格式**：歌词文件每行格式为"时间(秒):歌词内容"或"时间(秒),歌词内容"，支持#开头的注释行

## 故障排除

- **音乐不播放**：检查pygame是否正确安装，以及周杰伦文件夹中是否有有效的音频文件
- **播放错误**：可能是音频文件格式不兼容，尝试使用常见的.mp3格式
- **音量问题**：可以在代码中修改`pygame.mixer.music.set_volume(0.5)`中的值调整音量
- **调试帮助**：程序现在会输出详细的日志信息，可以在控制台查看音乐播放的完整过程
- **歌词不显示**：检查是否存在对应的歌词文件，文件名是否与音乐文件相同但扩展名为.txt，格式是否正确
- **歌词格式错误**：确保歌词文件每行格式符合"时间:歌词"或"时间,歌词"的格式

## 最新更新

- 增加了音乐播放的触发概率，让大白鹅更容易开始唱歌
- 添加了完整的错误处理机制，确保音乐播放更加稳定
- 优化了线程管理，防止同时启动多个音乐播放线程
- 添加了pygame.mixer的自动重新初始化功能
- 完善了日志输出，方便调试和问题排查
- 新增歌词显示功能，支持同步显示歌词内容
- 新增从文件加载歌词的功能，支持自定义歌词内容
- 优化了歌词显示逻辑，采用基于索引的定时更新方式